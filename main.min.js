'use strict';var degreeUnitState={last:'degree-f',current:'degree-f'},graphTemparatures,browserLocation={},locationInput=document.getElementById('location-input'),locationParams={types:['(regions)']},autocomplete=new google.maps.places.Autocomplete(locationInput,locationParams);(function(){var a=['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'],b=['January','February','March','April','May','June','July','August','September','October','November','December'];Date.prototype.getMonthName=function(){return b[this.getMonth()]},Date.prototype.getDayName=function(){return a[this.getDay()]},Date.prototype.getFormatedDate=function(){var c=this.getDate(),d='th',f=c%10;return[1,2,3].includes(f)&&(1==f?d='st':2==f?d='nd':d='rd'),''+c+d},Date.prototype.getNextFourDays=function(){var c=this.getDay(),d=(c+4)%7,f=[d-3,d-2,d-1,d];return f=f.map(function(g){return 0>g?g+7:g}),f.map(function(g){return a[g]})}})(),window.onload=function(){google.maps.event.addListener(autocomplete,'place_changed',updateCard),navigator.geolocation?navigator.geolocation.getCurrentPosition(function(a){if(a.coords.latitude&&a.coords.longitude){browserLocation.lat=a.coords.latitude,browserLocation.lon=a.coords.longitude;var b='https://maps.googleapis.com/maps/api/geocode/json?latlng='+browserLocation.lat+','+browserLocation.lon+'&result_type=locality&key=AIzaSyCthCggpjlXE_ztlKMW0SmcYKV6nro7vD0';fetch(b).then(function(c){return c.json()}).then(function(c){var d=c.results[0].address_components;if(d){var f=d.filter(function(g){return g.types.includes('locality')});f?(browserLocation.name=f[0].long_name,makeDefaultCard()):console.log('no items of type "locality"')}else console.log('issue with data.results[0].address_components')}).catch(function(c){return console.log(c)})}else console.log('geolocation supported but user not allowing access to location data')}):console.log('navigator.geolocation not supported.')}(),document.getElementById('degree-f').addEventListener('click',function(){degreeUnitState.last=degreeUnitState.current,degreeUnitState.current='degree-f',updateDegreeUnit(degreeUnitState)}),document.getElementById('degree-c').addEventListener('click',function(){degreeUnitState.last=degreeUnitState.current,degreeUnitState.current='degree-c',updateDegreeUnit(degreeUnitState)});var detailsIcons=document.getElementsByClassName('fa-arrow-circle-o-down');Array.prototype.map.call(detailsIcons,function(a){a.onclick=function(b){var c=b.target,d=c.parentElement.parentElement.parentElement.parentElement;['forecast-day-summary-1','forecast-day-summary-2','forecast-day-summary-3','forecast-day-summary-4'].filter(function(f){return f!==d.lastElementChild.id}).map(function(f){var g=document.getElementById(f);g.classList.contains('hide')||g.classList.add('hide')}),d.lastElementChild.classList.contains('hide')?d.lastElementChild.classList.remove('hide'):d.lastElementChild.classList.add('hide')}});function updateDegreeUnit(a){var b=document.getElementById('degree-f'),c=document.getElementById('degree-c');'degree-f'===a.current?(b.classList.add('active-degree-unit'),c.classList.remove('active-degree-unit'),'degree-c'===a.last&&updateDegreeValues('C-to-F')):(b.classList.remove('active-degree-unit'),c.classList.add('active-degree-unit'),'degree-f'===a.last&&updateDegreeValues('F-to-C'))}function updateDate(){var a=document.getElementById('day-name'),b=document.getElementById('month-and-day'),c=new Date;a.textContent=c.getDayName(),b.textContent=c.getMonthName()+' '+c.getFormatedDate()}function updateForecastDays(){var b=new Date,c=b.getNextFourDays();['forecast-day-1','forecast-day-2','forecast-day-3','forecast-day-4'].map(function(d,f){document.getElementById(d).textContent=c[f]})}function updateLocationName(){var a;return autocomplete.getPlace().formatted_address&&(a=autocomplete.getPlace().formatted_address.split(',')[0]),document.getElementById('city').textContent=a,a}function updateLocationCoordinates(){var a=autocomplete.getPlace();return{lat:a.geometry.location.lat(),lon:a.geometry.location.lng()}}function updateWeatherSummary(a){document.getElementById('weather-summary').textContent=''+a.hourly.summary,document.getElementById('weather-icon-description').textContent=''+a.currently.summary,document.getElementById('forecast-day-summary-1').textContent=''+a.daily.data[1].summary,document.getElementById('forecast-day-summary-2').textContent=''+a.daily.data[2].summary,document.getElementById('forecast-day-summary-3').textContent=''+a.daily.data[3].summary,document.getElementById('forecast-day-summary-4').textContent=''+a.daily.data[4].summary}function updateDegreeValues(a){['weather-status-now-temp','weather-status-low-temp','weather-status-high-temp','forecast-low-1','forecast-high-1','forecast-low-2','forecast-high-2','forecast-low-3','forecast-high-3','forecast-low-4','forecast-high-4'].map(function(c,d){var f=Number.parseInt(document.getElementById(c).textContent),g=f;'C-to-F'===a?g=Math.round(9/5*f+32):'F-to-C'==a&&(g=Math.round(5/9*(f-32))),0===d?document.getElementById(c).innerHTML=''+g+'&#176':document.getElementById(c).textContent=g}),'C-to-F'===a?(graphTemparatures=graphTemparatures.map(function(c){return Math.round(9/5*c+32)}),drawGraph(graphTemparatures)):'F-to-C'==a&&(graphTemparatures=graphTemparatures.map(function(c){return Math.round(5/9*(c-32))}),drawGraph(graphTemparatures))}function formatPercentValue(a){return Math.round(100*Number.parseFloat(a))}function formatTempValue(a){return'degree-c'===degreeUnitState.current?Math.round(5/9*(Number.parseFloat(a)-32)):Math.round(Number.parseFloat(a))}function getWeatherValues(a){var b=[];return b[0]=formatTempValue(a.currently.temperature),b[1]=formatTempValue(a.daily.data[0].temperatureMin),b[2]=formatTempValue(a.daily.data[0].temperatureMax),b[3]=formatPercentValue(a.currently.precipProbability),b[4]=formatPercentValue(a.currently.humidity),b[5]=Math.round(a.currently.windSpeed),b[6]=formatPercentValue(a.daily.data[1].precipProbability),b[7]=formatPercentValue(a.daily.data[2].precipProbability),b[8]=formatPercentValue(a.daily.data[3].precipProbability),b[9]=formatPercentValue(a.daily.data[4].precipProbability),b[10]=formatTempValue(a.daily.data[1].temperatureMin),b[11]=formatTempValue(a.daily.data[1].temperatureMax),b[12]=formatTempValue(a.daily.data[2].temperatureMin),b[13]=formatTempValue(a.daily.data[2].temperatureMax),b[14]=formatTempValue(a.daily.data[3].temperatureMin),b[15]=formatTempValue(a.daily.data[3].temperatureMax),b[16]=formatTempValue(a.daily.data[4].temperatureMin),b[17]=formatTempValue(a.daily.data[4].temperatureMax),b}function updateWeatherValues(a){['weather-status-now-temp','weather-status-low-temp','weather-status-high-temp','precipitation-value','humidity-value','wind-value','forecast-precipitation-1','forecast-precipitation-2','forecast-precipitation-3','forecast-precipitation-4','forecast-low-1','forecast-high-1','forecast-low-2','forecast-high-2','forecast-low-3','forecast-high-3','forecast-low-4','forecast-high-4'].map(function(c,d){0===d?document.getElementById(c).innerHTML=''+a[d]+'&#176':document.getElementById(c).textContent=a[d]})}function getWeatherIcons(a){var b=[];return b[0]=a.currently.icon,b[1]=a.daily.data[1].icon,b[2]=a.daily.data[2].icon,b[3]=a.daily.data[3].icon,b[4]=a.daily.data[4].icon,b}function updateWeatherIcons(a){['weather-icon-img','forecast-icon-1','forecast-icon-2','forecast-icon-3','forecast-icon-4'].map(function(b,c){var d=document.getElementById(b),f=d.classList;d.classList.replace(f[1],'wi-forecast-io-'+a[c])})}function drawGraph(a){var b=document.getElementById('tertiary-info');b.classList.add('blank'),b.innerHTML='<canvas id="weather-chart"></canvas>',new Chart(document.getElementById('weather-chart').getContext('2d'),{type:'line',data:{labels:['12am','4am','8am','12pm','4pm','8pm','11pm'],datasets:[{label:'',datalabels:{align:'end',anchor:'start'},data:a,borderColor:'black',pointBackgroundColor:'white',pointHoverBackgroundColor:'black',pointBorderColor:'black',borderWidth:1}]},options:{layout:{padding:{top:5}},responsive:!0,plugins:{datalabels:{backgroundColor:'transparent',color:'black',font:{weight:'bolder',family:'WeblySleekNormal',size:10},formatter:function formatter(c){return c+'\xB0'}}},scales:{xAxes:[{gridLines:{display:!1},ticks:{fontFamily:'WeblySleekNormal',fontSize:10}}],yAxes:[{stacked:!0,display:!1,gridLines:{display:!1},ticks:{beginAtZero:!1,display:!1,max:Math.max.apply(null,a)+10}}]},legend:{display:!1},tooltips:{enabled:!1}}}),b.classList.remove('blank')}function updateGraph(a){var d='https://api.darksky.net/forecast/6bf729e87190a68b87ac59112ff3b3b9/'+a.lat+','+a.lon+','+function(){return Math.round(new Date().getTime()/1e3)}()+'?exclude=minutely,daily,currently,flags,alerts';fetch('https://cors-anywhere.herokuapp.com/'+d).then(function(f){return f.json()}).then(function(f){var g=f.hourly.data.filter(function(h,i){return 0==i%4||23===i});return graphTemparatures=g.map(function(h){return formatTempValue(h.temperature)}),graphTemparatures}).then(drawGraph).catch(function(f){return console.log(f)})}function makeDefaultCard(){updateDate(),updateForecastDays(),updateDegreeUnit(degreeUnitState),document.getElementById('city').textContent=browserLocation.name;var b='https://api.darksky.net/forecast/6bf729e87190a68b87ac59112ff3b3b9/'+browserLocation.lat+','+browserLocation.lon+'?exclude=minutely,flags,alerts';fetch('https://cors-anywhere.herokuapp.com/'+b).then(function(d){return d.json()}).then(function(d){return updateWeatherSummary(d),updateWeatherValues(getWeatherValues(d)),updateWeatherIcons(getWeatherIcons(d)),{lat:d.latitude,lon:d.longitude}}).then(updateGraph).catch(function(d){return console.log(d)}),document.getElementById('weather-card').classList.remove('blank')}function updateCard(){var a=document.getElementById('weather-card');a.classList.add('blank'),updateDate(),updateForecastDays(),updateDegreeUnit(degreeUnitState),updateLocationName();var b=updateLocationCoordinates(),d='https://api.darksky.net/forecast/6bf729e87190a68b87ac59112ff3b3b9/'+b.lat+','+b.lon+'?exclude=minutely,flags,alerts';fetch('https://cors-anywhere.herokuapp.com/'+d).then(function(g){return g.json()}).then(function(g){updateWeatherSummary(g),updateWeatherValues(getWeatherValues(g)),updateWeatherIcons(getWeatherIcons(g)),updateGraph(b),a.classList.contains('hide')&&a.classList.remove('hide'),a.classList.remove('blank')}).catch(function(g){return console.log(g)})}
